import{r as x,a as k,j as I}from"./index.ac6fbdb6.js";import{i as K,f as V,v as R}from"./init.5cf38b0f.js";import{i as c,C as s,p as T,j as m,E as S,a as y,q as B,r as F,s as j,t as W,L as z,k as N,u as Y,v as q,w as J,M as Q}from"./Viewer.b4a6b501.js";class X{constructor(i){this.viewer=i,this.entityCollection=[],this.viewer.scene.globe.depthTestAgainstTerrain=!0}getCollection(){return this.entityCollection}destroy(i){for(var e=0;e<this.entityCollection.length;e++)this.viewer.entities.remove(this.entityCollection[e]);this.viewer.screenSpaceEventHandler.removeInputAction(c.LEFT_CLICK),this.viewer.screenSpaceEventHandler.removeInputAction(c.MOUSE_MOVE),this.viewer.screenSpaceEventHandler.removeInputAction(c.RIGHT_CLICK),this.entityCollection=[],i&&i()}measurePolyLine(i){var e=[],t=null;this.viewer.screenSpaceEventHandler.setInputAction(a=>{var n=this.viewer.scene.pickPosition(a.position);if(console.log(n),!n)return!1;e.length==0?(e.push(n.clone()),this.addPoint(n),this.viewer.screenSpaceEventHandler.setInputAction(l=>{var r=this.viewer.scene.pickPosition(l.endPosition);if(!r)return!1;if(e.length==2){e.pop(),e.push(r),t&&(this.viewer.entities.remove(t),this.entityCollection.splice(this.entityCollection.indexOf(t),1));var o=s.midpoint(e[0],e[1],new s),h="\u8DDD\u79BB\uFF1A"+this.getLengthText(e[0],e[1]);t=this.addLabel(o,h),this.entityCollection.push(t)}else e.push(r),this.addLine(e)},c.MOUSE_MOVE)):(e.pop(),e.push(n),this.addPoint(n),this.addLine(e),this.viewer.screenSpaceEventHandler.removeInputAction(c.LEFT_CLICK),this.viewer.screenSpaceEventHandler.removeInputAction(c.MOUSE_MOVE),i&&i())},c.LEFT_CLICK)}measurePolygon(i){var e=[],t=!1,a=null;this.viewer.scene.globe.depthTestAgainstTerrain=!1,this.viewer.screenSpaceEventHandler.setInputAction(n=>{t=!0;var l=this.viewer.scene.globe.pick(this.viewer.camera.getPickRay(n.position),this.viewer.scene);if(!l)return!1;if(e.length==0)e.push(l.clone()),this.addPoint(l),this.viewer.screenSpaceEventHandler.setInputAction(r=>{var o=this.viewer.scene.globe.pick(this.viewer.camera.getPickRay(r.endPosition),this.viewer.scene);if(!o)return!1;if(e.length==1?(e.push(o),this.addLine(e)):(t||e.pop(),e.push(o)),e.length>=3){a&&(this.viewer.entities.remove(a),this.entityCollection.splice(this.entityCollection.indexOf(a),1));var h="\u9762\u79EF\uFF1A"+this.getArea(e),p=this.getCenterOfGravityPoint(e);a=this.addLabel(p,h),this.entityCollection.push(a)}t=!1},c.MOUSE_MOVE);else if(e.length==2){if(!l)return!1;e.pop(),e.push(l.clone()),this.addPoint(l),this.addPolyGon(e),this.viewer.screenSpaceEventHandler.setInputAction(r=>{var o=this.viewer.scene.globe.pick(this.viewer.camera.getPickRay(r.position),this.viewer.scene);if(!o)return!1;e.pop(),e.push(o),e.push(e[0]),this.addPoint(o),this.viewer.screenSpaceEventHandler.removeInputAction(c.LEFT_CLICK),this.viewer.screenSpaceEventHandler.removeInputAction(c.MOUSE_MOVE),this.viewer.screenSpaceEventHandler.removeInputAction(c.RIGHT_CLICK),i&&i()},c.RIGHT_CLICK)}else if(e.length>=3){if(!l)return!1;e.pop(),e.push(l.clone()),this.addPoint(l)}},c.LEFT_CLICK)}measureHeight(i){var e=[],t=null,a=null,n=null;this.viewer.screenSpaceEventHandler.setInputAction(l=>{var r=this.viewer.scene.pickPosition(l.position);if(e.length==0){if(!r)return!1;e.push(r.clone()),this.addPoint(r),this.viewer.screenSpaceEventHandler.setInputAction(b=>{var f=this.viewer.scene.pickPosition(b.endPosition);if(!f)return!1;if(e.length>=2){e.pop(),e.pop(),e.pop();var E=T.fromCartesian(f),D=T.fromCartesian(e[0]).height,L=s.fromDegrees(m.toDegrees(E.longitude),m.toDegrees(E.latitude),D);e.push(L),e.push(f),e.push(e[0]),t&&(this.viewer.entities.remove(t),this.entityCollection.splice(this.entityCollection.indexOf(t),1),this.viewer.entities.remove(a),this.entityCollection.splice(this.entityCollection.indexOf(a),1),this.viewer.entities.remove(n),this.entityCollection.splice(this.entityCollection.indexOf(n),1));var v=s.midpoint(e[0],e[1],new s),d="\u6C34\u5E73\u8DDD\u79BB\uFF1A"+this.getLengthText(e[0],e[1]);t=this.addLabel(v,d),this.entityCollection.push(t);var g=s.midpoint(e[1],e[2],new s),w="\u5782\u76F4\u8DDD\u79BB\uFF1A"+this.getLengthText(e[1],e[2]);a=this.addLabel(g,w),this.entityCollection.push(a);var u=s.midpoint(e[2],e[3],new s),P="\u76F4\u7EBF\u8DDD\u79BB\uFF1A"+this.getLengthText(e[2],e[3]);n=this.addLabel(u,P),this.entityCollection.push(n)}else{var L=new s(f.x,f.y,e[0].z);e.push(L),e.push(f),e.push(e[0]),this.addLine(e)}},c.MOUSE_MOVE)}else{e.pop(),e.pop(),e.pop();var o=T.fromCartesian(r),h=T.fromCartesian(e[0]).height,p=s.fromDegrees(m.toDegrees(o.longitude),m.toDegrees(o.latitude),h);e.push(p),e.push(r),e.push(e[0]),this.addPoint(r),this.viewer.screenSpaceEventHandler.removeInputAction(c.LEFT_CLICK),this.viewer.screenSpaceEventHandler.removeInputAction(c.MOUSE_MOVE),i&&i()}},c.LEFT_CLICK)}addPoint(i){console.log("position",i),this.entityCollection.push(this.viewer.entities.add(new S({position:i,point:{color:y.BLUE,pixelSize:5,heightReference:B.NONE}})))}addLine(i){var e=new F(()=>i,!1);this.entityCollection.push(this.viewer.entities.add(new S({polyline:{positions:e,width:2,arcType:j.RHUMB,clampToGround:!1,material:y.RED,heightReference:B.CLAMP_TO_GROUND}})))}addPolyGon(i){var e=new F(()=>new q(i),!1);this.entityCollection.push(this.viewer.entities.add(new S({polygon:{hierarchy:e,material:y.RED.withAlpha(.6),classificationType:W.BOTH}})))}addLabel(i,e){return this.viewer.entities.add(new S({position:i,label:{text:e,font:"14px sans-serif",style:z.FILL_AND_OUTLINE,fillColor:y.YELLOW,showBackground:!0,backgroundColor:new y(.165,.165,.165,.8),backgroundPadding:new N(6,6),pixelOffset:new N(0,-25),disableDepthTestDistance:Number.POSITIVE_INFINITY}}))}getLengthText(i,e){var t=s.distance(i,e);return t>1e3?t=(t/1e3).toFixed(2)+" \u516C\u91CC":t=t.toFixed(2)+" \u7C73",t}getArea(i){for(var e=[],t=0;t<i.length;t++){var a=Y.WGS84.cartesianToCartographic(i[t]),n=this.viewer.scene.globe.getHeight(a),l=s.fromDegrees(a.longitude/Math.PI*180,a.latitude/Math.PI*180,n);e.push(l)}for(var r=0,t=0;t<e.length;t++){var o=e[t],h;t<e.length-1?h=e[t+1]:h=e[0],r+=o.x*h.y-h.x*o.y}var p;return r<1e6?p=Math.abs(r).toFixed(4)+" \u5E73\u65B9\u7C73":p=Math.abs((r/1e6).toFixed(4))+" \u5E73\u65B9\u516C\u91CC",p}getCenterOfGravityPoint(i){for(var e=i[0],t=1;t<i.length;t++)e=s.midpoint(e,i[t],new s);return e}}const Z="_container_129sw_1",$="_tools_129sw_5",U={container:Z,tools:$},ne=()=>{const M=x.exports.useRef(null),i=x.exports.useRef(null);return x.exports.useEffect(()=>{K(M.current),V();function e(n){let l=[];const r=n.viewer,o=n.radius,h=n.color,p=n.speed,b=n.position[0],f=n.position[1];r.entities.add({position:new s.fromDegrees(b,f),name:"\u7ACB\u4F53\u96F7\u8FBE\u626B\u63CF",ellipsoid:{radii:new s(o,o,o),material:h,outline:!0,outlineColor:new y(1,1,0,1),outlineWidth:1}});let E=0;r.clock.onTick.addEventListener(()=>{E+=p,l=D(113.9236839,22.528061,1e3,E)}),r.entities.add({wall:{positions:new F(()=>s.fromDegreesArrayHeights(l),!1),material:h}});function D(v,d,g,w){var u=J.eastNorthUpToFixedFrame(s.fromDegrees(v,d)),P=g*Math.cos(w*Math.PI/180),C=g*Math.sin(w*Math.PI/180),H=s.fromElements(P,C,0),_=Q.multiplyByPoint(u,H,new s),A=T.fromCartesian(_),O=m.toDegrees(A.longitude),G=m.toDegrees(A.latitude);return L(v,d,O,G)}function L(v,d,g,w){let u=[];u.push(v),u.push(d),u.push(0);var P=s.distance(s.fromDegrees(v,d),s.fromDegrees(g,w));for(let C=0;C<=90;C++){let H=P*Math.sin(C*Math.PI/180),_=Math.cos(C*Math.PI/180),A=(g-v)*_+v,O=(w-d)*_+d;u.push(A),u.push(O),u.push(H)}return u}}e({viewer:R,position:[113.9236839,22.528061],radius:1e3,color:new y(1,1,0,.3),speed:5});let t=new X(R);const a=n=>{if(n.target.nodeName.toLocaleLowerCase()==="button")switch(n.target.dataset.type){case"PolyLine":t.measurePolyLine(function(){console.log("\u8DDD\u79BB\u91CF\u6D4B")});break;case"Polygon":t.measurePolygon(function(){console.log("\u9762\u79EF\u6D4B\u91CF")});break;case"Height":t.measureHeight(function(){console.log("\u9AD8\u5EA6\u6D4B\u91CF")});break;case"Clean":t.destroy(function(){});break}};return i.current.addEventListener("click",a,!1),()=>{i.current.removeEventListener("click",a,!1)}},[]),k("section",{className:U.container,children:[k("div",{className:U.tools,ref:i,children:[I("button",{"data-type":"PolyLine",children:"\u8DDD\u79BB"}),I("button",{"data-type":"Polygon",children:"\u9762\u79EF"}),I("button",{"data-type":"Height",children:"\u9AD8\u5EA6"}),I("button",{"data-type":"Clean",children:"\u6E05\u9664"})]}),I("div",{style:{height:"100vh"},ref:M})]})};export{ne as default};
