import{L as ft,h as J,i as be,C as D,j as kt,k as Ot,D as It,l as te,s as X,m as K,g as ht,n as xe,o as Nt,p as Ft,Q as Dt,N as Pt,q as ye,r as Ht,t as Bt,u as Ut,v as pt,w as Gt,x as Vt,R as Me,y as _t,z as jt,B as mt,H as Kt,J as zt,K as Xt,O as ve,U as Wt,X as Te,Y as $t,Z as Yt,_ as qt,$ as gt,a0 as Jt,b as bt,a1 as Qt,a2 as yt,a3 as Zt,a4 as en,a5 as tn,a6 as nn,G as Ae,P as vt,a7 as sn,a8 as rn,a9 as on,aa as ze,ab as an,ac as ln,ad as cn,ae as un,af as wt,ag as dn,ah as fn,ai as Xe,aj as hn,V as he,ak as pn,al as _n,am as pe,an as Se,ao as _e,ap as mn,W as gn,aq as bn,S as yn,ar as vn,F as wn,as as En,at as xn}from"./three.module.c85d35f8.js";import{O as Tn}from"./OrbitControls.a97767ed.js";import{r as We,j as An}from"./index.7442dff7.js";class Sn extends ft{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new kn(t)}),this.register(function(t){return new Hn(t)}),this.register(function(t){return new Bn(t)}),this.register(function(t){return new In(t)}),this.register(function(t){return new Nn(t)}),this.register(function(t){return new Fn(t)}),this.register(function(t){return new Dn(t)}),this.register(function(t){return new Mn(t)}),this.register(function(t){return new Pn(t)}),this.register(function(t){return new On(t)}),this.register(function(t){return new Cn(t)}),this.register(function(t){return new Un(t)})}load(e,t,s,n){const i=this;let r;this.resourcePath!==""?r=this.resourcePath:this.path!==""?r=this.path:r=J.extractUrlBase(e),this.manager.itemStart(e);const l=function(c){n?n(c):console.error(c),i.manager.itemError(e),i.manager.itemEnd(e)},a=new be(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{i.parse(c,r,function(f){t(f),i.manager.itemEnd(e)},l)}catch(f){l(f)}},s,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let i;const r={},l={};if(typeof e=="string")i=e;else if(J.decodeText(new Uint8Array(e,0,4))===Et){try{r[S.KHR_BINARY_GLTF]=new Gn(e)}catch(u){n&&n(u);return}i=r[S.KHR_BINARY_GLTF].content}else i=J.decodeText(new Uint8Array(e));const a=JSON.parse(i);if(a.asset===void 0||a.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new es(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let f=0;f<this.pluginCallbacks.length;f++){const u=this.pluginCallbacks[f](c);l[u.name]=u,r[u.name]=!0}if(a.extensionsUsed)for(let f=0;f<a.extensionsUsed.length;++f){const u=a.extensionsUsed[f],h=a.extensionsRequired||[];switch(u){case S.KHR_MATERIALS_UNLIT:r[u]=new Ln;break;case S.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[u]=new Kn;break;case S.KHR_DRACO_MESH_COMPRESSION:r[u]=new Vn(a,this.dracoLoader);break;case S.KHR_TEXTURE_TRANSFORM:r[u]=new jn;break;case S.KHR_MESH_QUANTIZATION:r[u]=new zn;break;default:h.indexOf(u)>=0&&l[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(r),c.setPlugins(l),c.parse(s,n)}parseAsync(e,t){const s=this;return new Promise(function(n,i){s.parse(e,t,n,i)})}}function Rn(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const S={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Cn{constructor(e){this.parser=e,this.name=S.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const i=t[s];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let n=t.cache.get(s);if(n)return n;const i=t.json,a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let c;const f=new D(16777215);a.color!==void 0&&f.fromArray(a.color);const u=a.range!==void 0?a.range:0;switch(a.type){case"directional":c=new It(f),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Ot(f),c.distance=u;break;case"spot":c=new kt(f),c.distance=u,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,c.angle=a.spot.outerConeAngle,c.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return c.position.set(0,0,0),c.decay=2,a.intensity!==void 0&&(c.intensity=a.intensity),c.name=t.createUniqueName(a.name||"light_"+e),n=Promise.resolve(c),t.cache.add(s,n),n}createNodeAttachment(e){const t=this,s=this.parser,i=s.json.nodes[e],l=(i.extensions&&i.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(a){return s._getNodeRef(t.cache,l,a)})}}class Ln{constructor(){this.name=S.KHR_MATERIALS_UNLIT}getMaterialType(){return te}extendParams(e,t,s){const n=[];e.color=new D(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const r=i.baseColorFactor;e.color.fromArray(r),e.opacity=r[3]}i.baseColorTexture!==void 0&&n.push(s.assignTexture(e,"map",i.baseColorTexture,X))}return Promise.all(n)}}class Mn{constructor(e){this.parser=e,this.name=S.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class kn{constructor(e){this.parser=e,this.name=S.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:K}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(i.push(s.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const l=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ht(l,l)}return Promise.all(i)}}class On{constructor(e){this.parser=e,this.name=S.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:K}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(i)}}class In{constructor(e){this.parser=e,this.name=S.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:K}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new D(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=n.extensions[this.name];return r.sheenColorFactor!==void 0&&t.sheenColor.fromArray(r.sheenColorFactor),r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&i.push(s.assignTexture(t,"sheenColorMap",r.sheenColorTexture,X)),r.sheenRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(i)}}class Nn{constructor(e){this.parser=e,this.name=S.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:K}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&i.push(s.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(i)}}class Fn{constructor(e){this.parser=e,this.name=S.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:K}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&i.push(s.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||0;const l=r.attenuationColor||[1,1,1];return t.attenuationColor=new D(l[0],l[1],l[2]),Promise.all(i)}}class Dn{constructor(e){this.parser=e,this.name=S.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:K}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class Pn{constructor(e){this.parser=e,this.name=S.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:K}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&i.push(s.assignTexture(t,"specularIntensityMap",r.specularTexture));const l=r.specularColorFactor||[1,1,1];return t.specularColor=new D(l[0],l[1],l[2]),r.specularColorTexture!==void 0&&i.push(s.assignTexture(t,"specularColorMap",r.specularColorTexture,X)),Promise.all(i)}}class Hn{constructor(e){this.parser=e,this.name=S.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,r)}}class Bn{constructor(e){this.parser=e,this.name=S.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const r=i.extensions[t],l=n.images[r.source];let a=s.textureLoader;if(l.uri){const c=s.options.manager.getHandler(l.uri);c!==null&&(a=c)}return this.detectSupport().then(function(c){if(c)return s.loadTextureImage(e,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Un{constructor(e){this.name=S.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const n=s.extensions[this.name],i=this.parser.getDependency("buffer",n.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,r.ready]).then(function(l){const a=n.byteOffset||0,c=n.byteLength||0,f=n.count,u=n.byteStride,h=new ArrayBuffer(f*u),_=new Uint8Array(l[0],a,c);return r.decodeGltfBuffer(new Uint8Array(h),f,u,_,n.mode,n.filter),h})}else return null}}const Et="glTF",se=12,$e={JSON:1313821514,BIN:5130562};class Gn{constructor(e){this.name=S.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,se);if(this.header={magic:J.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Et)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-se,n=new DataView(e,se);let i=0;for(;i<s;){const r=n.getUint32(i,!0);i+=4;const l=n.getUint32(i,!0);if(i+=4,l===$e.JSON){const a=new Uint8Array(e,se+i,r);this.content=J.decodeText(a)}else if(l===$e.BIN){const a=se+i;this.body=e.slice(a,a+r)}i+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Vn{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=S.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,l={},a={},c={};for(const f in r){const u=Oe[f]||f.toLowerCase();l[u]=r[f]}for(const f in e.attributes){const u=Oe[f]||f.toLowerCase();if(r[f]!==void 0){const h=s.accessors[e.attributes[f]],_=ue[h.componentType];c[u]=_,a[u]=h.normalized===!0}}return t.getDependency("bufferView",i).then(function(f){return new Promise(function(u){n.decodeDracoFile(f,function(h){for(const _ in h.attributes){const y=h.attributes[_],m=a[_];m!==void 0&&(y.normalized=m)}u(h)},l,c)})})}}class jn{constructor(){this.name=S.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class ke extends xe{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),s=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),l={specular:{value:new D().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=l,this.onBeforeCompile=function(a){for(const c in l)a.uniforms[c]=l[c];a.fragmentShader=a.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return l.specular.value},set:function(a){l.specular.value=a}},specularMap:{get:function(){return l.specularMap.value},set:function(a){l.specularMap.value=a,a?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return l.glossiness.value},set:function(a){l.glossiness.value=a}},glossinessMap:{get:function(){return l.glossinessMap.value},set:function(a){l.glossinessMap.value=a,a?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Kn{constructor(){this.name=S.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return ke}extendParams(e,t,s){const n=t.extensions[this.name];e.color=new D(1,1,1),e.opacity=1;const i=[];if(Array.isArray(n.diffuseFactor)){const r=n.diffuseFactor;e.color.fromArray(r),e.opacity=r[3]}if(n.diffuseTexture!==void 0&&i.push(s.assignTexture(e,"map",n.diffuseTexture,X)),e.emissive=new D(0,0,0),e.glossiness=n.glossinessFactor!==void 0?n.glossinessFactor:1,e.specular=new D(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),n.specularGlossinessTexture!==void 0){const r=n.specularGlossinessTexture;i.push(s.assignTexture(e,"glossinessMap",r)),i.push(s.assignTexture(e,"specularMap",r,X))}return Promise.all(i)}createMaterial(e){const t=new ke(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Nt,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class zn{constructor(){this.name=S.KHR_MESH_QUANTIZATION}}class Ue extends Ft{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,i=e*n*3+n;for(let r=0;r!==n;r++)t[r]=s[i+r];return t}}Ue.prototype.interpolate_=function(o,e,t,s){const n=this.resultBuffer,i=this.sampleValues,r=this.valueSize,l=r*2,a=r*3,c=s-e,f=(t-e)/c,u=f*f,h=u*f,_=o*a,y=_-a,m=-2*h+3*u,g=h-u,v=1-m,L=g-u+f;for(let b=0;b!==r;b++){const x=i[y+b+r],R=i[y+b+l]*c,T=i[_+b+r],A=i[_+b]*c;n[b]=v*x+L*R+m*T+g*A}return n};const Xn=new Dt;class Wn extends Ue{interpolate_(e,t,s,n){const i=super.interpolate_(e,t,s,n);return Xn.fromArray(i).normalize().toArray(i),i}}const j={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ue={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ye={9728:Pt,9729:ye,9984:Ht,9985:Bt,9986:Ut,9987:pt},qe={33071:Gt,33648:Vt,10497:Me},Je={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Oe={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},z={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},$n={CUBICSPLINE:void 0,LINEAR:_t,STEP:jt},Re={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Yn(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new xe({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:fn})),o.DefaultMaterial}function ie(o,e,t){for(const s in t.extensions)o[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function q(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function qn(o,e,t){let s=!1,n=!1,i=!1;for(let c=0,f=e.length;c<f;c++){const u=e[c];if(u.POSITION!==void 0&&(s=!0),u.NORMAL!==void 0&&(n=!0),u.COLOR_0!==void 0&&(i=!0),s&&n&&i)break}if(!s&&!n&&!i)return Promise.resolve(o);const r=[],l=[],a=[];for(let c=0,f=e.length;c<f;c++){const u=e[c];if(s){const h=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):o.attributes.position;r.push(h)}if(n){const h=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):o.attributes.normal;l.push(h)}if(i){const h=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):o.attributes.color;a.push(h)}}return Promise.all([Promise.all(r),Promise.all(l),Promise.all(a)]).then(function(c){const f=c[0],u=c[1],h=c[2];return s&&(o.morphAttributes.position=f),n&&(o.morphAttributes.normal=u),i&&(o.morphAttributes.color=h),o.morphTargetsRelative=!0,o})}function Jn(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let s=0,n=t.length;s<n;s++)o.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Qn(o){const e=o.extensions&&o.extensions[S.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+Qe(e.attributes):t=o.indices+":"+Qe(o.attributes)+":"+o.mode,t}function Qe(o){let e="";const t=Object.keys(o).sort();for(let s=0,n=t.length;s<n;s++)e+=t[s]+":"+o[t[s]]+";";return e}function Ie(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Zn(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class es{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Rn,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,i=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||s||n&&i<98?this.textureLoader=new mt(this.options.manager):this.textureLoader=new Kt(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new be(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(r){const l={scene:r[0][n.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:n.asset,parser:s,userData:{}};ie(i,l,n),q(l,n),Promise.all(s._invokeAll(function(a){return a.afterRoot&&a.afterRoot(l)})).then(function(){e(l)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let n=0,i=t.length;n<i;n++){const r=t[n].joints;for(let l=0,a=r.length;l<a;l++)e[r[l]].isBone=!0}for(let n=0,i=e.length;n<i;n++){const r=e[n];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(s[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone(),i=(r,l)=>{const a=this.associations.get(r);a!=null&&this.associations.set(l,a);for(const[c,f]of r.children.entries())i(f,l.children[c])};return i(s,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i&&s.push(i)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(i,r){return s.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[S.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(i,r){s.load(J.resolveURL(t.uri,n.path),i,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const n=t.byteLength||0,i=t.byteOffset||0;return s.slice(i,i+n)})}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0)return Promise.resolve(null);const i=[];return n.bufferView!==void 0?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),n.sparse!==void 0&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(r){const l=r[0],a=Je[n.type],c=ue[n.componentType],f=c.BYTES_PER_ELEMENT,u=f*a,h=n.byteOffset||0,_=n.bufferView!==void 0?s.bufferViews[n.bufferView].byteStride:void 0,y=n.normalized===!0;let m,g;if(_&&_!==u){const v=Math.floor(h/_),L="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+v+":"+n.count;let b=t.cache.get(L);b||(m=new c(l,v*_,n.count*_/f),b=new zt(m,_/f),t.cache.add(L,b)),g=new Xt(b,a,h%_/f,y)}else l===null?m=new c(n.count*a):m=new c(l,h,n.count*a),g=new ve(m,a,y);if(n.sparse!==void 0){const v=Je.SCALAR,L=ue[n.sparse.indices.componentType],b=n.sparse.indices.byteOffset||0,x=n.sparse.values.byteOffset||0,R=new L(r[1],b,n.sparse.count*v),T=new c(r[2],x,n.sparse.count*a);l!==null&&(g=new ve(g.array.slice(),g.itemSize,g.normalized));for(let A=0,C=R.length;A<C;A++){const w=R[A];if(g.setX(w,T[A*a]),a>=2&&g.setY(w,T[A*a+1]),a>=3&&g.setZ(w,T[A*a+2]),a>=4&&g.setW(w,T[A*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,s=this.options,i=t.textures[e].source,r=t.images[i];let l=this.textureLoader;if(r.uri){const a=s.manager.getHandler(r.uri);a!==null&&(l=a)}return this.loadTextureImage(e,i,l)}loadTextureImage(e,t,s){const n=this,i=this.json,r=i.textures[e],l=i.images[t],a=(l.uri||l.bufferView)+":"+r.sampler;if(this.textureCache[a])return this.textureCache[a];const c=this.loadImageSource(t,s).then(function(f){f.flipY=!1,r.name&&(f.name=r.name);const h=(i.samplers||{})[r.sampler]||{};return f.magFilter=Ye[h.magFilter]||ye,f.minFilter=Ye[h.minFilter]||pt,f.wrapS=qe[h.wrapS]||Me,f.wrapT=qe[h.wrapT]||Me,n.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[a]=c,c}loadImageSource(e,t){const s=this,n=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const r=n.images[e],l=self.URL||self.webkitURL;let a=r.uri||"",c=!1;if(r.bufferView!==void 0)a=s.getDependency("bufferView",r.bufferView).then(function(u){c=!0;const h=new Blob([u],{type:r.mimeType});return a=l.createObjectURL(h),a});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(a).then(function(u){return new Promise(function(h,_){let y=h;t.isImageBitmapLoader===!0&&(y=function(m){const g=new Xe(m);g.needsUpdate=!0,h(g)}),t.load(J.resolveURL(u,i.path),y,void 0,_)})}).then(function(u){return c===!0&&l.revokeObjectURL(a),u.userData.mimeType=r.mimeType||Zn(r.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),u});return this.sourceCache[e]=f,f}assignTexture(e,t,s,n){const i=this;return this.getDependency("texture",s.index).then(function(r){if(s.texCoord!==void 0&&s.texCoord!=0&&!(t==="aoMap"&&s.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+t+" not yet supported."),i.extensions[S.KHR_TEXTURE_TRANSFORM]){const l=s.extensions!==void 0?s.extensions[S.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const a=i.associations.get(r);r=i.extensions[S.KHR_TEXTURE_TRANSFORM].extendTexture(r,l),i.associations.set(r,a)}}return n!==void 0&&(r.encoding=n),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const n=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const l="PointsMaterial:"+s.uuid;let a=this.cache.get(l);a||(a=new Wt,Te.prototype.copy.call(a,s),a.color.copy(s.color),a.map=s.map,a.sizeAttenuation=!1,this.cache.add(l,a)),s=a}else if(e.isLine){const l="LineBasicMaterial:"+s.uuid;let a=this.cache.get(l);a||(a=new $t,Te.prototype.copy.call(a,s),a.color.copy(s.color),this.cache.add(l,a)),s=a}if(n||i||r){let l="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),n&&(l+="derivative-tangents:"),i&&(l+="vertex-colors:"),r&&(l+="flat-shading:");let a=this.cache.get(l);a||(a=s.clone(),i&&(a.vertexColors=!0),r&&(a.flatShading=!0),n&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(l,a),this.associations.set(a,this.associations.get(s))),s=a}s.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=s}getMaterialType(){return xe}loadMaterial(e){const t=this,s=this.json,n=this.extensions,i=s.materials[e];let r;const l={},a=i.extensions||{},c=[];if(a[S.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const u=n[S.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=u.getMaterialType(),c.push(u.extendParams(l,i,t))}else if(a[S.KHR_MATERIALS_UNLIT]){const u=n[S.KHR_MATERIALS_UNLIT];r=u.getMaterialType(),c.push(u.extendParams(l,i,t))}else{const u=i.pbrMetallicRoughness||{};if(l.color=new D(1,1,1),l.opacity=1,Array.isArray(u.baseColorFactor)){const h=u.baseColorFactor;l.color.fromArray(h),l.opacity=h[3]}u.baseColorTexture!==void 0&&c.push(t.assignTexture(l,"map",u.baseColorTexture,X)),l.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,l.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(l,"metalnessMap",u.metallicRoughnessTexture)),c.push(t.assignTexture(l,"roughnessMap",u.metallicRoughnessTexture))),r=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,l)})))}i.doubleSided===!0&&(l.side=Yt);const f=i.alphaMode||Re.OPAQUE;if(f===Re.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,f===Re.MASK&&(l.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&r!==te&&(c.push(t.assignTexture(l,"normalMap",i.normalTexture)),l.normalScale=new ht(1,1),i.normalTexture.scale!==void 0)){const u=i.normalTexture.scale;l.normalScale.set(u,u)}return i.occlusionTexture!==void 0&&r!==te&&(c.push(t.assignTexture(l,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&r!==te&&(l.emissive=new D().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&r!==te&&c.push(t.assignTexture(l,"emissiveMap",i.emissiveTexture,X)),Promise.all(c).then(function(){let u;return r===ke?u=n[S.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):u=new r(l),i.name&&(u.name=i.name),q(u,i),t.associations.set(u,{materials:e}),i.extensions&&ie(n,u,i),u})}createUniqueName(e){const t=qt.sanitizeNodeName(e||"");let s=t;for(let n=1;this.nodeNamesUsed[s];++n)s=t+"_"+n;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const t=this,s=this.extensions,n=this.primitiveCache;function i(l){return s[S.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,t).then(function(a){return Ze(a,l,t)})}const r=[];for(let l=0,a=e.length;l<a;l++){const c=e[l],f=Qn(c),u=n[f];if(u)r.push(u.promise);else{let h;c.extensions&&c.extensions[S.KHR_DRACO_MESH_COMPRESSION]?h=i(c):h=Ze(new gt,c,t),n[f]={primitive:c,promise:h},r.push(h)}}return Promise.all(r)}loadMesh(e){const t=this,s=this.json,n=this.extensions,i=s.meshes[e],r=i.primitives,l=[];for(let a=0,c=r.length;a<c;a++){const f=r[a].material===void 0?Yn(this.cache):this.getDependency("material",r[a].material);l.push(f)}return l.push(t.loadGeometries(r)),Promise.all(l).then(function(a){const c=a.slice(0,a.length-1),f=a[a.length-1],u=[];for(let _=0,y=f.length;_<y;_++){const m=f[_],g=r[_];let v;const L=c[_];if(g.mode===j.TRIANGLES||g.mode===j.TRIANGLE_STRIP||g.mode===j.TRIANGLE_FAN||g.mode===void 0)v=i.isSkinnedMesh===!0?new Jt(m,L):new bt(m,L),v.isSkinnedMesh===!0&&!v.geometry.attributes.skinWeight.normalized&&v.normalizeSkinWeights(),g.mode===j.TRIANGLE_STRIP?v.geometry=et(v.geometry,Qt):g.mode===j.TRIANGLE_FAN&&(v.geometry=et(v.geometry,yt));else if(g.mode===j.LINES)v=new Zt(m,L);else if(g.mode===j.LINE_STRIP)v=new en(m,L);else if(g.mode===j.LINE_LOOP)v=new tn(m,L);else if(g.mode===j.POINTS)v=new nn(m,L);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(v.geometry.morphAttributes).length>0&&Jn(v,i),v.name=t.createUniqueName(i.name||"mesh_"+e),q(v,i),g.extensions&&ie(n,v,g),t.assignFinalMaterial(v),u.push(v)}for(let _=0,y=u.length;_<y;_++)t.associations.set(u[_],{meshes:e,primitives:_});if(u.length===1)return u[0];const h=new Ae;t.associations.set(h,{meshes:e});for(let _=0,y=u.length;_<y;_++)h.add(u[_]);return h})}loadCamera(e){let t;const s=this.json.cameras[e],n=s[s.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new vt(sn.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):s.type==="orthographic"&&(t=new rn(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),q(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then(function(n){return s.inverseBindMatrices=n,s})}loadAnimation(e){const s=this.json.animations[e],n=[],i=[],r=[],l=[],a=[];for(let c=0,f=s.channels.length;c<f;c++){const u=s.channels[c],h=s.samplers[u.sampler],_=u.target,y=_.node!==void 0?_.node:_.id,m=s.parameters!==void 0?s.parameters[h.input]:h.input,g=s.parameters!==void 0?s.parameters[h.output]:h.output;n.push(this.getDependency("node",y)),i.push(this.getDependency("accessor",m)),r.push(this.getDependency("accessor",g)),l.push(h),a.push(_)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(l),Promise.all(a)]).then(function(c){const f=c[0],u=c[1],h=c[2],_=c[3],y=c[4],m=[];for(let v=0,L=f.length;v<L;v++){const b=f[v],x=u[v],R=h[v],T=_[v],A=y[v];if(b===void 0)continue;b.updateMatrix(),b.matrixAutoUpdate=!0;let C;switch(z[A.path]){case z.weights:C=an;break;case z.rotation:C=ze;break;case z.position:case z.scale:default:C=on;break}const w=b.name?b.name:b.uuid,k=T.interpolation!==void 0?$n[T.interpolation]:_t,E=[];z[A.path]===z.weights?b.traverse(function(F){F.morphTargetInfluences&&E.push(F.name?F.name:F.uuid)}):E.push(w);let N=R.array;if(R.normalized){const F=Ie(N.constructor),G=new Float32Array(N.length);for(let O=0,fe=N.length;O<fe;O++)G[O]=N[O]*F;N=G}for(let F=0,G=E.length;F<G;F++){const O=new C(E[F]+"."+z[A.path],x.array,N,k);T.interpolation==="CUBICSPLINE"&&(O.createInterpolant=function(P){const H=this instanceof ze?Wn:Ue;return new H(this.times,this.values,this.getValueSize()/3,P)},O.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),m.push(O)}}const g=s.name?s.name:"animation_"+e;return new ln(g,void 0,m)})}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return n.mesh===void 0?null:s.getDependency("mesh",n.mesh).then(function(i){const r=s._getNodeRef(s.meshCache,n.mesh,i);return n.weights!==void 0&&r.traverse(function(l){if(!!l.isMesh)for(let a=0,c=n.weights.length;a<c;a++)l.morphTargetInfluences[a]=n.weights[a]}),r})}loadNode(e){const t=this.json,s=this.extensions,n=this,i=t.nodes[e],r=i.name?n.createUniqueName(i.name):"";return function(){const l=[],a=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return a&&l.push(a),i.camera!==void 0&&l.push(n.getDependency("camera",i.camera).then(function(c){return n._getNodeRef(n.cameraCache,i.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){l.push(c)}),Promise.all(l)}().then(function(l){let a;if(i.isBone===!0?a=new cn:l.length>1?a=new Ae:l.length===1?a=l[0]:a=new un,a!==l[0])for(let c=0,f=l.length;c<f;c++)a.add(l[c]);if(i.name&&(a.userData.name=i.name,a.name=r),q(a,i),i.extensions&&ie(s,a,i),i.matrix!==void 0){const c=new wt;c.fromArray(i.matrix),a.applyMatrix4(c)}else i.translation!==void 0&&a.position.fromArray(i.translation),i.rotation!==void 0&&a.quaternion.fromArray(i.rotation),i.scale!==void 0&&a.scale.fromArray(i.scale);return n.associations.has(a)||n.associations.set(a,{}),n.associations.get(a).nodes=e,a})}loadScene(e){const t=this.json,s=this.extensions,n=this.json.scenes[e],i=this,r=new Ae;n.name&&(r.name=i.createUniqueName(n.name)),q(r,n),n.extensions&&ie(s,r,n);const l=n.nodes||[],a=[];for(let c=0,f=l.length;c<f;c++)a.push(xt(l[c],r,t,i));return Promise.all(a).then(function(){const c=f=>{const u=new Map;for(const[h,_]of i.associations)(h instanceof Te||h instanceof Xe)&&u.set(h,_);return f.traverse(h=>{const _=i.associations.get(h);_!=null&&u.set(h,_)}),u};return i.associations=c(r),r})}}function xt(o,e,t,s){const n=t.nodes[o];return s.getDependency("node",o).then(function(i){if(n.skin===void 0)return i;let r;return s.getDependency("skin",n.skin).then(function(l){r=l;const a=[];for(let c=0,f=r.joints.length;c<f;c++)a.push(s.getDependency("node",r.joints[c]));return Promise.all(a)}).then(function(l){return i.traverse(function(a){if(!a.isMesh)return;const c=[],f=[];for(let u=0,h=l.length;u<h;u++){const _=l[u];if(_){c.push(_);const y=new wt;r.inverseBindMatrices!==void 0&&y.fromArray(r.inverseBindMatrices.array,u*16),f.push(y)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[u])}a.bind(new dn(c,f),a.matrixWorld)}),i})}).then(function(i){e.add(i);const r=[];if(n.children){const l=n.children;for(let a=0,c=l.length;a<c;a++){const f=l[a];r.push(xt(f,i,t,s))}}return Promise.all(r)})}function ts(o,e,t){const s=e.attributes,n=new hn;if(s.POSITION!==void 0){const l=t.json.accessors[s.POSITION],a=l.min,c=l.max;if(a!==void 0&&c!==void 0){if(n.set(new he(a[0],a[1],a[2]),new he(c[0],c[1],c[2])),l.normalized){const f=Ie(ue[l.componentType]);n.min.multiplyScalar(f),n.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const l=new he,a=new he;for(let c=0,f=i.length;c<f;c++){const u=i[c];if(u.POSITION!==void 0){const h=t.json.accessors[u.POSITION],_=h.min,y=h.max;if(_!==void 0&&y!==void 0){if(a.setX(Math.max(Math.abs(_[0]),Math.abs(y[0]))),a.setY(Math.max(Math.abs(_[1]),Math.abs(y[1]))),a.setZ(Math.max(Math.abs(_[2]),Math.abs(y[2]))),h.normalized){const m=Ie(ue[h.componentType]);a.multiplyScalar(m)}l.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(l)}o.boundingBox=n;const r=new pn;n.getCenter(r.center),r.radius=n.min.distanceTo(n.max)/2,o.boundingSphere=r}function Ze(o,e,t){const s=e.attributes,n=[];function i(r,l){return t.getDependency("accessor",r).then(function(a){o.setAttribute(l,a)})}for(const r in s){const l=Oe[r]||r.toLowerCase();l in o.attributes||n.push(i(s[r],l))}if(e.indices!==void 0&&!o.index){const r=t.getDependency("accessor",e.indices).then(function(l){o.setIndex(l)});n.push(r)}return q(o,e),ts(o,e,t),Promise.all(n).then(function(){return e.targets!==void 0?qn(o,e.targets,t):o})}function et(o,e){let t=o.getIndex();if(t===null){const r=[],l=o.getAttribute("position");if(l!==void 0){for(let a=0;a<l.count;a++)r.push(a);o.setIndex(r),t=o.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const s=t.count-2,n=[];if(e===yt)for(let r=1;r<=s;r++)n.push(t.getX(0)),n.push(t.getX(r)),n.push(t.getX(r+1));else for(let r=0;r<s;r++)r%2===0?(n.push(t.getX(r)),n.push(t.getX(r+1)),n.push(t.getX(r+2))):(n.push(t.getX(r+2)),n.push(t.getX(r+1)),n.push(t.getX(r)));n.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=o.clone();return i.setIndex(n),i}const Ce=new WeakMap;class ns extends ft{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,s,n){const i=new be(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,r=>{const l={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(r,l).then(t).catch(n)},s,n)}decodeDracoFile(e,t,s,n){const i={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!s};this.decodeGeometry(e,i).then(t)}decodeGeometry(e,t){for(const a in t.attributeTypes){const c=t.attributeTypes[a];c.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[a]=c.name)}const s=JSON.stringify(t);if(Ce.has(e)){const a=Ce.get(e);if(a.key===s)return a.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const i=this.workerNextTaskID++,r=e.byteLength,l=this._getWorker(i,r).then(a=>(n=a,new Promise((c,f)=>{n._callbacks[i]={resolve:c,reject:f},n.postMessage({type:"decode",id:i,taskConfig:t,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return l.catch(()=>!0).then(()=>{n&&i&&this._releaseTask(n,i)}),Ce.set(e,{key:s,promise:l}),l}_createGeometry(e){const t=new gt;e.index&&t.setIndex(new ve(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const n=e.attributes[s],i=n.name,r=n.array,l=n.itemSize;t.setAttribute(i,new ve(r,l))}return t}_loadLibrary(e,t){const s=new be(this.manager);return s.setPath(this.decoderPath),s.setResponseType(t),s.setWithCredentials(this.withCredentials),new Promise((n,i)=>{s.load(e,n,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(s=>{const n=s[0];e||(this.decoderConfig.wasmBinary=s[1]);const i=ss.toString(),r=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(i){const r=i.data;switch(r.type){case"decode":n._callbacks[r.id].resolve(r);break;case"error":n._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,i){return n._taskLoad>i._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[e]=t,s._taskLoad+=t,s})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function ss(){let o,e;onmessage=function(r){const l=r.data;switch(l.type){case"init":o=l.decoderConfig,e=new Promise(function(f){o.onModuleLoaded=function(u){f({draco:u})},DracoDecoderModule(o)});break;case"decode":const a=l.buffer,c=l.taskConfig;e.then(f=>{const u=f.draco,h=new u.Decoder,_=new u.DecoderBuffer;_.Init(new Int8Array(a),a.byteLength);try{const y=t(u,h,_,c),m=y.attributes.map(g=>g.array.buffer);y.index&&m.push(y.index.array.buffer),self.postMessage({type:"decode",id:l.id,geometry:y},m)}catch(y){console.error(y),self.postMessage({type:"error",id:l.id,error:y.message})}finally{u.destroy(_),u.destroy(h)}});break}};function t(r,l,a,c){const f=c.attributeIDs,u=c.attributeTypes;let h,_;const y=l.GetEncodedGeometryType(a);if(y===r.TRIANGULAR_MESH)h=new r.Mesh,_=l.DecodeBufferToMesh(a,h);else if(y===r.POINT_CLOUD)h=new r.PointCloud,_=l.DecodeBufferToPointCloud(a,h);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!_.ok()||h.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+_.error_msg());const m={index:null,attributes:[]};for(const g in f){const v=self[u[g]];let L,b;if(c.useUniqueIDs)b=f[g],L=l.GetAttributeByUniqueId(h,b);else{if(b=l.GetAttributeId(h,r[f[g]]),b===-1)continue;L=l.GetAttribute(h,b)}m.attributes.push(n(r,l,h,g,v,L))}return y===r.TRIANGULAR_MESH&&(m.index=s(r,l,h)),r.destroy(h),m}function s(r,l,a){const f=a.num_faces()*3,u=f*4,h=r._malloc(u);l.GetTrianglesUInt32Array(a,u,h);const _=new Uint32Array(r.HEAPF32.buffer,h,f).slice();return r._free(h),{array:_,itemSize:1}}function n(r,l,a,c,f,u){const h=u.num_components(),y=a.num_points()*h,m=y*f.BYTES_PER_ELEMENT,g=i(r,f),v=r._malloc(m);l.GetAttributeDataArrayForAllPoints(a,u,g,m,v);const L=new f(r.HEAPF32.buffer,v,y).slice();return r._free(v),{name:c,array:L,itemSize:h}}function i(r,l){switch(l){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}class is extends _n{constructor(e){super(e),this.type=pe}parse(e){const l=function(b,x){switch(b){case 1:console.error("THREE.RGBELoader Read Error: "+(x||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(x||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(x||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(x||""))}return-1},u=`
`,h=function(b,x,R){x=x||1024;let A=b.pos,C=-1,w=0,k="",E=String.fromCharCode.apply(null,new Uint16Array(b.subarray(A,A+128)));for(;0>(C=E.indexOf(u))&&w<x&&A<b.byteLength;)k+=E,w+=E.length,A+=128,E+=String.fromCharCode.apply(null,new Uint16Array(b.subarray(A,A+128)));return-1<C?(R!==!1&&(b.pos+=w+C+1),k+E.slice(0,C)):!1},_=function(b){const x=/^#\?(\S+)/,R=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,T=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,A=/^\s*FORMAT=(\S+)\s*$/,C=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,w={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let k,E;if(b.pos>=b.byteLength||!(k=h(b)))return l(1,"no header found");if(!(E=k.match(x)))return l(3,"bad initial token");for(w.valid|=1,w.programtype=E[1],w.string+=k+`
`;k=h(b),k!==!1;){if(w.string+=k+`
`,k.charAt(0)==="#"){w.comments+=k+`
`;continue}if((E=k.match(R))&&(w.gamma=parseFloat(E[1])),(E=k.match(T))&&(w.exposure=parseFloat(E[1])),(E=k.match(A))&&(w.valid|=2,w.format=E[1]),(E=k.match(C))&&(w.valid|=4,w.height=parseInt(E[1],10),w.width=parseInt(E[2],10)),w.valid&2&&w.valid&4)break}return w.valid&2?w.valid&4?w:l(3,"missing image size specifier"):l(3,"missing format specifier")},y=function(b,x,R){const T=x;if(T<8||T>32767||b[0]!==2||b[1]!==2||b[2]&128)return new Uint8Array(b);if(T!==(b[2]<<8|b[3]))return l(3,"wrong scanline width");const A=new Uint8Array(4*x*R);if(!A.length)return l(4,"unable to allocate buffer space");let C=0,w=0;const k=4*T,E=new Uint8Array(4),N=new Uint8Array(k);let F=R;for(;F>0&&w<b.byteLength;){if(w+4>b.byteLength)return l(1);if(E[0]=b[w++],E[1]=b[w++],E[2]=b[w++],E[3]=b[w++],E[0]!=2||E[1]!=2||(E[2]<<8|E[3])!=T)return l(3,"bad rgbe scanline format");let G=0,O;for(;G<k&&w<b.byteLength;){O=b[w++];const P=O>128;if(P&&(O-=128),O===0||G+O>k)return l(3,"bad scanline data");if(P){const H=b[w++];for(let Ke=0;Ke<O;Ke++)N[G++]=H}else N.set(b.subarray(w,w+O),G),G+=O,w+=O}const fe=T;for(let P=0;P<fe;P++){let H=0;A[C]=N[P+H],H+=T,A[C+1]=N[P+H],H+=T,A[C+2]=N[P+H],H+=T,A[C+3]=N[P+H],C+=4}F--}return A},m=function(b,x,R,T){const A=b[x+3],C=Math.pow(2,A-128)/255;R[T+0]=b[x+0]*C,R[T+1]=b[x+1]*C,R[T+2]=b[x+2]*C,R[T+3]=1},g=function(b,x,R,T){const A=b[x+3],C=Math.pow(2,A-128)/255;R[T+0]=_e.toHalfFloat(Math.min(b[x+0]*C,65504)),R[T+1]=_e.toHalfFloat(Math.min(b[x+1]*C,65504)),R[T+2]=_e.toHalfFloat(Math.min(b[x+2]*C,65504)),R[T+3]=_e.toHalfFloat(1)},v=new Uint8Array(e);v.pos=0;const L=_(v);if(L!==-1){const b=L.width,x=L.height,R=y(v.subarray(v.pos),b,x);if(R!==-1){let T,A,C;switch(this.type){case Se:C=R.length/4;const w=new Float32Array(C*4);for(let E=0;E<C;E++)m(R,E*4,w,E*4);T=w,A=Se;break;case pe:C=R.length/4;const k=new Uint16Array(C*4);for(let E=0;E<C;E++)g(R,E*4,k,E*4);T=k,A=pe;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:b,height:x,data:T,header:L.string,gamma:L.gamma,exposure:L.exposure,type:A}}}return null}setDataType(e){return this.type=e,this}load(e,t,s,n){function i(r,l){switch(r.type){case Se:case pe:r.encoding=mn,r.minFilter=ye,r.magFilter=ye,r.generateMipmaps=!1,r.flipY=!0;break}t&&t(r,l)}return super.load(e,i,s,n)}}function rs(o){if(!!o&&!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=o,document.head.appendChild(e),o}}function ne(o,e){var t=o.__state.conversionName.toString(),s=Math.round(o.r),n=Math.round(o.g),i=Math.round(o.b),r=o.a,l=Math.round(o.h),a=o.s.toFixed(1),c=o.v.toFixed(1);if(e||t==="THREE_CHAR_HEX"||t==="SIX_CHAR_HEX"){for(var f=o.hex.toString(16);f.length<6;)f="0"+f;return"#"+f}else{if(t==="CSS_RGB")return"rgb("+s+","+n+","+i+")";if(t==="CSS_RGBA")return"rgba("+s+","+n+","+i+","+r+")";if(t==="HEX")return"0x"+o.hex.toString(16);if(t==="RGB_ARRAY")return"["+s+","+n+","+i+"]";if(t==="RGBA_ARRAY")return"["+s+","+n+","+i+","+r+"]";if(t==="RGB_OBJ")return"{r:"+s+",g:"+n+",b:"+i+"}";if(t==="RGBA_OBJ")return"{r:"+s+",g:"+n+",b:"+i+",a:"+r+"}";if(t==="HSV_OBJ")return"{h:"+l+",s:"+a+",v:"+c+"}";if(t==="HSVA_OBJ")return"{h:"+l+",s:"+a+",v:"+c+",a:"+r+"}"}return"unknown format"}var tt=Array.prototype.forEach,re=Array.prototype.slice,p={BREAK:{},extend:function(e){return this.each(re.call(arguments,1),function(t){var s=this.isObject(t)?Object.keys(t):[];s.forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(re.call(arguments,1),function(t){var s=this.isObject(t)?Object.keys(t):[];s.forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=re.call(arguments);return function(){for(var t=re.call(arguments),s=e.length-1;s>=0;s--)t=[e[s].apply(this,t)];return t[0]}},each:function(e,t,s){if(!!e){if(tt&&e.forEach&&e.forEach===tt)e.forEach(t,s);else if(e.length===e.length+0){var n=void 0,i=void 0;for(n=0,i=e.length;n<i;n++)if(n in e&&t.call(s,e[n],n)===this.BREAK)return}else for(var r in e)if(t.call(s,e[r],r)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,t,s){var n=void 0;return function(){var i=this,r=arguments;function l(){n=null,s||e.apply(i,r)}var a=s||!n;clearTimeout(n),n=setTimeout(l,t),a&&e.apply(i,r)}},toArray:function(e){return e.toArray?e.toArray():re.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(o){function e(t){return o.apply(this,arguments)}return e.toString=function(){return o.toString()},e}(function(o){return isNaN(o)}),isArray:Array.isArray||function(o){return o.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},os=[{litmus:p.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:ne},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:ne},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:ne},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:ne}}},{litmus:p.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:p.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:p.isObject,conversions:{RGBA_OBJ:{read:function(e){return p.isNumber(e.r)&&p.isNumber(e.g)&&p.isNumber(e.b)&&p.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return p.isNumber(e.r)&&p.isNumber(e.g)&&p.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return p.isNumber(e.h)&&p.isNumber(e.s)&&p.isNumber(e.v)&&p.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return p.isNumber(e.h)&&p.isNumber(e.s)&&p.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],oe=void 0,me=void 0,Ne=function(){me=!1;var e=arguments.length>1?p.toArray(arguments):arguments[0];return p.each(os,function(t){if(t.litmus(e))return p.each(t.conversions,function(s,n){if(oe=s.read(e),me===!1&&oe!==!1)return me=oe,oe.conversionName=n,oe.conversion=s,p.BREAK}),p.BREAK}),me},nt=void 0,we={hsv_to_rgb:function(e,t,s){var n=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=s*(1-t),l=s*(1-i*t),a=s*(1-(1-i)*t),c=[[s,a,r],[l,s,r],[r,s,a],[r,l,s],[a,r,s],[s,r,l]][n];return{r:c[0]*255,g:c[1]*255,b:c[2]*255}},rgb_to_hsv:function(e,t,s){var n=Math.min(e,t,s),i=Math.max(e,t,s),r=i-n,l=void 0,a=void 0;if(i!==0)a=r/i;else return{h:NaN,s:0,v:0};return e===i?l=(t-s)/r:t===i?l=2+(s-e)/r:l=4+(e-t)/r,l/=6,l<0&&(l+=1),{h:l*360,s:a,v:i/255}},rgb_to_hex:function(e,t,s){var n=this.hex_with_component(0,2,e);return n=this.hex_with_component(n,1,t),n=this.hex_with_component(n,0,s),n},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(e,t,s){return s<<(nt=t*8)|e&~(255<<nt)}},as=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},B=function(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")},U=function(){function o(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,s){return t&&o(e.prototype,t),s&&o(e,s),e}}(),W=function o(e,t,s){e===null&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(n===void 0){var i=Object.getPrototypeOf(e);return i===null?void 0:o(i,t,s)}else{if("value"in n)return n.value;var r=n.get;return r===void 0?void 0:r.call(s)}},$=function(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(o,e):o.__proto__=e)},Y=function(o,e){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:o},I=function(){function o(){if(B(this,o),this.__state=Ne.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return U(o,[{key:"toString",value:function(){return ne(this)}},{key:"toHexString",value:function(){return ne(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),o}();function Ge(o,e,t){Object.defineProperty(o,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(I.recalculateRGB(this,e,t),this.__state[e])},set:function(n){this.__state.space!=="RGB"&&(I.recalculateRGB(this,e,t),this.__state.space="RGB"),this.__state[e]=n}})}function Ve(o,e){Object.defineProperty(o,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(I.recalculateHSV(this),this.__state[e])},set:function(s){this.__state.space!=="HSV"&&(I.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=s}})}I.recalculateRGB=function(o,e,t){if(o.__state.space==="HEX")o.__state[e]=we.component_from_hex(o.__state.hex,t);else if(o.__state.space==="HSV")p.extend(o.__state,we.hsv_to_rgb(o.__state.h,o.__state.s,o.__state.v));else throw new Error("Corrupted color state")};I.recalculateHSV=function(o){var e=we.rgb_to_hsv(o.r,o.g,o.b);p.extend(o.__state,{s:e.s,v:e.v}),p.isNaN(e.h)?p.isUndefined(o.__state.h)&&(o.__state.h=0):o.__state.h=e.h};I.COMPONENTS=["r","g","b","h","s","v","hex","a"];Ge(I.prototype,"r",2);Ge(I.prototype,"g",1);Ge(I.prototype,"b",0);Ve(I.prototype,"h");Ve(I.prototype,"s");Ve(I.prototype,"v");Object.defineProperty(I.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(I.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=we.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Q=function(){function o(e,t){B(this,o),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return U(o,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),o}(),ls={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},Tt={};p.each(ls,function(o,e){p.each(o,function(t){Tt[t]=e})});var cs=/(\d+(\.\d+)?)px/;function V(o){if(o==="0"||p.isUndefined(o))return 0;var e=o.match(cs);return p.isNull(e)?0:parseFloat(e[1])}var d={makeSelectable:function(e,t){e===void 0||e.style===void 0||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,s){var n=s,i=t;p.isUndefined(i)&&(i=!0),p.isUndefined(n)&&(n=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,s,n){var i=s||{},r=Tt[t];if(!r)throw new Error("Event type "+t+" not supported.");var l=document.createEvent(r);switch(r){case"MouseEvents":{var a=i.x||i.clientX||0,c=i.y||i.clientY||0;l.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,c,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var f=l.initKeyboardEvent||l.initKeyEvent;p.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),f(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break}default:{l.initEvent(t,i.bubbles||!1,i.cancelable||!0);break}}p.defaults(l,n),e.dispatchEvent(l)},bind:function(e,t,s,n){var i=n||!1;return e.addEventListener?e.addEventListener(t,s,i):e.attachEvent&&e.attachEvent("on"+t,s),d},unbind:function(e,t,s,n){var i=n||!1;return e.removeEventListener?e.removeEventListener(t,s,i):e.detachEvent&&e.detachEvent("on"+t,s),d},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var s=e.className.split(/ +/);s.indexOf(t)===-1&&(s.push(t),e.className=s.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return d},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var s=e.className.split(/ +/),n=s.indexOf(t);n!==-1&&(s.splice(n,1),e.className=s.join(" "))}else e.className=void 0;return d},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return V(t["border-left-width"])+V(t["border-right-width"])+V(t["padding-left"])+V(t["padding-right"])+V(t.width)},getHeight:function(e){var t=getComputedStyle(e);return V(t["border-top-width"])+V(t["border-bottom-width"])+V(t["padding-top"])+V(t["padding-bottom"])+V(t.height)},getOffset:function(e){var t=e,s={left:0,top:0};if(t.offsetParent)do s.left+=t.offsetLeft,s.top+=t.offsetTop,t=t.offsetParent;while(t);return s},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},At=function(o){$(e,o);function e(t,s){B(this,e);var n=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s)),i=n;n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox");function r(){i.setValue(!i.__prev)}return d.bind(n.__checkbox,"change",r,!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return U(e,[{key:"setValue",value:function(s){var n=W(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,s);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),W(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Q),us=function(o){$(e,o);function e(t,s,n){B(this,e);var i=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s)),r=n,l=i;if(i.__select=document.createElement("select"),p.isArray(r)){var a={};p.each(r,function(c){a[c]=c}),r=a}return p.each(r,function(c,f){var u=document.createElement("option");u.innerHTML=f,u.setAttribute("value",c),l.__select.appendChild(u)}),i.updateDisplay(),d.bind(i.__select,"change",function(){var c=this.options[this.selectedIndex].value;l.setValue(c)}),i.domElement.appendChild(i.__select),i}return U(e,[{key:"setValue",value:function(s){var n=W(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,s);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return d.isActive(this.__select)?this:(this.__select.value=this.getValue(),W(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(Q),ds=function(o){$(e,o);function e(t,s){B(this,e);var n=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s)),i=n;function r(){i.setValue(i.__input.value)}function l(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),d.bind(n.__input,"keyup",r),d.bind(n.__input,"change",r),d.bind(n.__input,"blur",l),d.bind(n.__input,"keydown",function(a){a.keyCode===13&&this.blur()}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return U(e,[{key:"updateDisplay",value:function(){return d.isActive(this.__input)||(this.__input.value=this.getValue()),W(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Q);function st(o){var e=o.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var St=function(o){$(e,o);function e(t,s,n){B(this,e);var i=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s)),r=n||{};return i.__min=r.min,i.__max=r.max,i.__step=r.step,p.isUndefined(i.__step)?i.initialValue===0?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=st(i.__impliedStep),i}return U(e,[{key:"setValue",value:function(s){var n=s;return this.__min!==void 0&&n<this.__min?n=this.__min:this.__max!==void 0&&n>this.__max&&(n=this.__max),this.__step!==void 0&&n%this.__step!==0&&(n=Math.round(n/this.__step)*this.__step),W(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(s){return this.__min=s,this}},{key:"max",value:function(s){return this.__max=s,this}},{key:"step",value:function(s){return this.__step=s,this.__impliedStep=s,this.__precision=st(s),this}}]),e}(Q);function fs(o,e){var t=Math.pow(10,e);return Math.round(o*t)/t}var Ee=function(o){$(e,o);function e(t,s,n){B(this,e);var i=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s,n));i.__truncationSuspended=!1;var r=i,l=void 0;function a(){var y=parseFloat(r.__input.value);p.isNaN(y)||r.setValue(y)}function c(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function f(){c()}function u(y){var m=l-y.clientY;r.setValue(r.getValue()+m*r.__impliedStep),l=y.clientY}function h(){d.unbind(window,"mousemove",u),d.unbind(window,"mouseup",h),c()}function _(y){d.bind(window,"mousemove",u),d.bind(window,"mouseup",h),l=y.clientY}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),d.bind(i.__input,"change",a),d.bind(i.__input,"blur",f),d.bind(i.__input,"mousedown",_),d.bind(i.__input,"keydown",function(y){y.keyCode===13&&(r.__truncationSuspended=!0,this.blur(),r.__truncationSuspended=!1,c())}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return U(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():fs(this.getValue(),this.__precision),W(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(St);function it(o,e,t,s,n){return s+(n-s)*((o-e)/(t-e))}var Fe=function(o){$(e,o);function e(t,s,n,i,r){B(this,e);var l=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s,{min:n,max:i,step:r})),a=l;l.__background=document.createElement("div"),l.__foreground=document.createElement("div"),d.bind(l.__background,"mousedown",c),d.bind(l.__background,"touchstart",h),d.addClass(l.__background,"slider"),d.addClass(l.__foreground,"slider-fg");function c(m){document.activeElement.blur(),d.bind(window,"mousemove",f),d.bind(window,"mouseup",u),f(m)}function f(m){m.preventDefault();var g=a.__background.getBoundingClientRect();return a.setValue(it(m.clientX,g.left,g.right,a.__min,a.__max)),!1}function u(){d.unbind(window,"mousemove",f),d.unbind(window,"mouseup",u),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function h(m){m.touches.length===1&&(d.bind(window,"touchmove",_),d.bind(window,"touchend",y),_(m))}function _(m){var g=m.touches[0].clientX,v=a.__background.getBoundingClientRect();a.setValue(it(g,v.left,v.right,a.__min,a.__max))}function y(){d.unbind(window,"touchmove",_),d.unbind(window,"touchend",y),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return l.updateDisplay(),l.__background.appendChild(l.__foreground),l.domElement.appendChild(l.__background),l}return U(e,[{key:"updateDisplay",value:function(){var s=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=s*100+"%",W(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(St),Rt=function(o){$(e,o);function e(t,s,n){B(this,e);var i=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s)),r=i;return i.__button=document.createElement("div"),i.__button.innerHTML=n===void 0?"Fire":n,d.bind(i.__button,"click",function(l){return l.preventDefault(),r.fire(),!1}),d.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return U(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(Q),De=function(o){$(e,o);function e(t,s){B(this,e);var n=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s));n.__color=new I(n.getValue()),n.__temp=new I(0);var i=n;n.domElement=document.createElement("div"),d.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",d.bind(n.__input,"keydown",function(m){m.keyCode===13&&u.call(this)}),d.bind(n.__input,"blur",u),d.bind(n.__selector,"mousedown",function(){d.addClass(this,"drag").bind(window,"mouseup",function(){d.removeClass(i.__selector,"drag")})}),d.bind(n.__selector,"touchstart",function(){d.addClass(this,"drag").bind(window,"touchend",function(){d.removeClass(i.__selector,"drag")})});var r=document.createElement("div");p.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),p.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),p.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),p.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),p.extend(r.style,{width:"100%",height:"100%",background:"none"}),rt(r,"top","rgba(0,0,0,0)","#000"),p.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),ps(n.__hue_field),p.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),d.bind(n.__saturation_field,"mousedown",l),d.bind(n.__saturation_field,"touchstart",l),d.bind(n.__field_knob,"mousedown",l),d.bind(n.__field_knob,"touchstart",l),d.bind(n.__hue_field,"mousedown",a),d.bind(n.__hue_field,"touchstart",a);function l(m){_(m),d.bind(window,"mousemove",_),d.bind(window,"touchmove",_),d.bind(window,"mouseup",c),d.bind(window,"touchend",c)}function a(m){y(m),d.bind(window,"mousemove",y),d.bind(window,"touchmove",y),d.bind(window,"mouseup",f),d.bind(window,"touchend",f)}function c(){d.unbind(window,"mousemove",_),d.unbind(window,"touchmove",_),d.unbind(window,"mouseup",c),d.unbind(window,"touchend",c),h()}function f(){d.unbind(window,"mousemove",y),d.unbind(window,"touchmove",y),d.unbind(window,"mouseup",f),d.unbind(window,"touchend",f),h()}function u(){var m=Ne(this.value);m!==!1?(i.__color.__state=m,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function h(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}n.__saturation_field.appendChild(r),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay();function _(m){m.type.indexOf("touch")===-1&&m.preventDefault();var g=i.__saturation_field.getBoundingClientRect(),v=m.touches&&m.touches[0]||m,L=v.clientX,b=v.clientY,x=(L-g.left)/(g.right-g.left),R=1-(b-g.top)/(g.bottom-g.top);return R>1?R=1:R<0&&(R=0),x>1?x=1:x<0&&(x=0),i.__color.v=R,i.__color.s=x,i.setValue(i.__color.toOriginal()),!1}function y(m){m.type.indexOf("touch")===-1&&m.preventDefault();var g=i.__hue_field.getBoundingClientRect(),v=m.touches&&m.touches[0]||m,L=v.clientY,b=1-(L-g.top)/(g.bottom-g.top);return b>1?b=1:b<0&&(b=0),i.__color.h=b*360,i.setValue(i.__color.toOriginal()),!1}return n}return U(e,[{key:"updateDisplay",value:function(){var s=Ne(this.getValue());if(s!==!1){var n=!1;p.each(I.COMPONENTS,function(l){if(!p.isUndefined(s[l])&&!p.isUndefined(this.__color.__state[l])&&s[l]!==this.__color.__state[l])return n=!0,{}},this),n&&p.extend(this.__color.__state,s)}p.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,r=255-i;p.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,rt(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),p.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),e}(Q),hs=["-moz-","-o-","-webkit-","-ms-",""];function rt(o,e,t,s){o.style.background="",p.each(hs,function(n){o.style.cssText+="background: "+n+"linear-gradient("+e+", "+t+" 0%, "+s+" 100%); "})}function ps(o){o.style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var _s={load:function(e,t){var s=t||document,n=s.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,s.getElementsByTagName("head")[0].appendChild(n)},inject:function(e,t){var s=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var i=s.getElementsByTagName("head")[0];try{i.appendChild(n)}catch{}}},ms=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,gs=function(e,t){var s=e[t];return p.isArray(arguments[2])||p.isObject(arguments[2])?new us(e,t,arguments[2]):p.isNumber(s)?p.isNumber(arguments[2])&&p.isNumber(arguments[3])?p.isNumber(arguments[4])?new Fe(e,t,arguments[2],arguments[3],arguments[4]):new Fe(e,t,arguments[2],arguments[3]):p.isNumber(arguments[4])?new Ee(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Ee(e,t,{min:arguments[2],max:arguments[3]}):p.isString(s)?new ds(e,t):p.isFunction(s)?new Rt(e,t,""):p.isBoolean(s)?new At(e,t):null};function bs(o){setTimeout(o,1e3/60)}var ys=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||bs,vs=function(){function o(){B(this,o),this.backgroundElement=document.createElement("div"),p.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),d.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),p.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;d.bind(this.backgroundElement,"click",function(){e.hide()})}return U(o,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),p.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var t=this,s=function n(){t.domElement.style.display="none",t.backgroundElement.style.display="none",d.unbind(t.domElement,"webkitTransitionEnd",n),d.unbind(t.domElement,"transitionend",n),d.unbind(t.domElement,"oTransitionEnd",n)};d.bind(this.domElement,"webkitTransitionEnd",s),d.bind(this.domElement,"transitionend",s),d.bind(this.domElement,"oTransitionEnd",s),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-d.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-d.getHeight(this.domElement)/2+"px"}}]),o}(),ws=rs(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);_s.inject(ws);var ot="dg",at=72,lt=20,de="Default",ae=function(){try{return!!window.localStorage}catch{return!1}}(),le=void 0,ct=!0,Z=void 0,Le=!1,Ct=[],M=function o(e){var t=this,s=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),d.addClass(this.domElement,ot),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],s=p.defaults(s,{closeOnTop:!1,autoPlace:!0,width:o.DEFAULT_WIDTH}),s=p.defaults(s,{resizable:s.autoPlace,hideable:s.autoPlace}),p.isUndefined(s.load)?s.load={preset:de}:s.preset&&(s.load.preset=s.preset),p.isUndefined(s.parent)&&s.hideable&&Ct.push(this),s.resizable=p.isUndefined(s.parent)&&s.resizable,s.autoPlace&&p.isUndefined(s.scrollable)&&(s.scrollable=!0);var n=ae&&localStorage.getItem(ee(this,"isLocal"))==="true",i=void 0,r=void 0;if(Object.defineProperties(this,{parent:{get:function(){return s.parent}},scrollable:{get:function(){return s.scrollable}},autoPlace:{get:function(){return s.autoPlace}},closeOnTop:{get:function(){return s.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:s.load.preset},set:function(h){t.parent?t.getRoot().preset=h:s.load.preset=h,As(this),t.revert()}},width:{get:function(){return s.width},set:function(h){s.width=h,Be(t,h)}},name:{get:function(){return s.name},set:function(h){s.name=h,r&&(r.innerHTML=s.name)}},closed:{get:function(){return s.closed},set:function(h){s.closed=h,s.closed?d.addClass(t.__ul,o.CLASS_CLOSED):d.removeClass(t.__ul,o.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=h?o.TEXT_OPEN:o.TEXT_CLOSED)}},load:{get:function(){return s.load}},useLocalStorage:{get:function(){return n},set:function(h){ae&&(n=h,h?d.bind(window,"unload",i):d.unbind(window,"unload",i),localStorage.setItem(ee(t,"isLocal"),h))}}}),p.isUndefined(s.parent)){if(this.closed=s.closed||!1,d.addClass(this.domElement,o.CLASS_MAIN),d.makeSelectable(this.domElement,!1),ae&&n){t.useLocalStorage=!0;var l=localStorage.getItem(ee(this,"gui"));l&&(s.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=o.TEXT_CLOSED,d.addClass(this.__closeButton,o.CLASS_CLOSE_BUTTON),s.closeOnTop?(d.addClass(this.__closeButton,o.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(d.addClass(this.__closeButton,o.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),d.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{s.closed===void 0&&(s.closed=!0);var a=document.createTextNode(s.name);d.addClass(a,"controller-name"),r=je(t,a);var c=function(h){return h.preventDefault(),t.closed=!t.closed,!1};d.addClass(this.__ul,o.CLASS_CLOSED),d.addClass(r,"title"),d.bind(r,"click",c),s.closed||(this.closed=!1)}s.autoPlace&&(p.isUndefined(s.parent)&&(ct&&(Z=document.createElement("div"),d.addClass(Z,ot),d.addClass(Z,o.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Z),ct=!1),Z.appendChild(this.domElement),d.addClass(this.domElement,o.CLASS_AUTO_PLACE)),this.parent||Be(t,s.width)),this.__resizeHandler=function(){t.onResizeDebounced()},d.bind(window,"resize",this.__resizeHandler),d.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),d.bind(this.__ul,"transitionend",this.__resizeHandler),d.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),s.resizable&&Ts(this),i=function(){ae&&localStorage.getItem(ee(t,"isLocal"))==="true"&&localStorage.setItem(ee(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=i;function f(){var u=t.getRoot();u.width+=1,p.defer(function(){u.width-=1})}s.parent||f()};M.toggleHide=function(){Le=!Le,p.each(Ct,function(o){o.domElement.style.display=Le?"none":""})};M.CLASS_AUTO_PLACE="a";M.CLASS_AUTO_PLACE_CONTAINER="ac";M.CLASS_MAIN="main";M.CLASS_CONTROLLER_ROW="cr";M.CLASS_TOO_TALL="taller-than-window";M.CLASS_CLOSED="closed";M.CLASS_CLOSE_BUTTON="close-button";M.CLASS_CLOSE_TOP="close-top";M.CLASS_CLOSE_BOTTOM="close-bottom";M.CLASS_DRAG="drag";M.DEFAULT_WIDTH=245;M.TEXT_CLOSED="Close Controls";M.TEXT_OPEN="Open Controls";M._keydownHandler=function(o){document.activeElement.type!=="text"&&(o.which===at||o.keyCode===at)&&M.toggleHide()};d.bind(window,"keydown",M._keydownHandler,!1);p.extend(M.prototype,{add:function(e,t){return ce(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return ce(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;p.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Z.removeChild(this.domElement);var e=this;p.each(this.__folders,function(t){e.removeFolder(t)}),d.unbind(window,"keydown",M._keydownHandler,!1),ut(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var s=new M(t);this.__folders[e]=s;var n=je(this,s.domElement);return d.addClass(n,"folder"),s},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],ut(e);var t=this;p.each(e.__folders,function(s){e.removeFolder(s)}),p.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=d.getOffset(e.__ul).top,s=0;p.each(e.__ul.childNodes,function(n){e.autoPlace&&n===e.__save_row||(s+=d.getHeight(n))}),window.innerHeight-t-lt<s?(d.addClass(e.domElement,M.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-lt+"px"):(d.removeClass(e.domElement,M.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&p.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:p.debounce(function(){this.onResize()},50),remember:function(){if(p.isUndefined(le)&&(le=new vs,le.domElement.innerHTML=ms),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;p.each(Array.prototype.slice.call(arguments),function(t){e.__rememberedObjects.length===0&&xs(e),e.__rememberedObjects.indexOf(t)===-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&Be(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=ge(this)),e.folders={},p.each(this.__folders,function(t,s){e.folders[s]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ge(this),Pe(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[de]=ge(this,!0)),this.load.remembered[e]=ge(this),this.preset=e,He(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){p.each(this.__controllers,function(t){this.getRoot().load.remembered?Lt(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),p.each(this.__folders,function(t){t.revert(t)}),e||Pe(this.getRoot(),!1)},listen:function(e){var t=this.__listening.length===0;this.__listening.push(e),t&&Mt(this.__listening)},updateDisplay:function(){p.each(this.__controllers,function(e){e.updateDisplay()}),p.each(this.__folders,function(e){e.updateDisplay()})}});function je(o,e,t){var s=document.createElement("li");return e&&s.appendChild(e),t?o.__ul.insertBefore(s,t):o.__ul.appendChild(s),o.onResize(),s}function ut(o){d.unbind(window,"resize",o.__resizeHandler),o.saveToLocalStorageIfPossible&&d.unbind(window,"unload",o.saveToLocalStorageIfPossible)}function Pe(o,e){var t=o.__preset_select[o.__preset_select.selectedIndex];e?t.innerHTML=t.value+"*":t.innerHTML=t.value}function Es(o,e,t){if(t.__li=e,t.__gui=o,p.extend(t,{options:function(r){if(arguments.length>1){var l=t.__li.nextElementSibling;return t.remove(),ce(o,t.object,t.property,{before:l,factoryArgs:[p.toArray(arguments)]})}if(p.isArray(r)||p.isObject(r)){var a=t.__li.nextElementSibling;return t.remove(),ce(o,t.object,t.property,{before:a,factoryArgs:[r]})}},name:function(r){return t.__li.firstElementChild.firstElementChild.innerHTML=r,t},listen:function(){return t.__gui.listen(t),t},remove:function(){return t.__gui.remove(t),t}}),t instanceof Fe){var s=new Ee(t.object,t.property,{min:t.__min,max:t.__max,step:t.__step});p.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(i){var r=t[i],l=s[i];t[i]=s[i]=function(){var a=Array.prototype.slice.call(arguments);return l.apply(s,a),r.apply(t,a)}}),d.addClass(e,"has-slider"),t.domElement.insertBefore(s.domElement,t.domElement.firstElementChild)}else if(t instanceof Ee){var n=function(r){if(p.isNumber(t.__min)&&p.isNumber(t.__max)){var l=t.__li.firstElementChild.firstElementChild.innerHTML,a=t.__gui.__listening.indexOf(t)>-1;t.remove();var c=ce(o,t.object,t.property,{before:t.__li.nextElementSibling,factoryArgs:[t.__min,t.__max,t.__step]});return c.name(l),a&&c.listen(),c}return r};t.min=p.compose(n,t.min),t.max=p.compose(n,t.max)}else t instanceof At?(d.bind(e,"click",function(){d.fakeEvent(t.__checkbox,"click")}),d.bind(t.__checkbox,"click",function(i){i.stopPropagation()})):t instanceof Rt?(d.bind(e,"click",function(){d.fakeEvent(t.__button,"click")}),d.bind(e,"mouseover",function(){d.addClass(t.__button,"hover")}),d.bind(e,"mouseout",function(){d.removeClass(t.__button,"hover")})):t instanceof De&&(d.addClass(e,"color"),t.updateDisplay=p.compose(function(i){return e.style.borderLeftColor=t.__color.toString(),i},t.updateDisplay),t.updateDisplay());t.setValue=p.compose(function(i){return o.getRoot().__preset_select&&t.isModified()&&Pe(o.getRoot(),!0),i},t.setValue)}function Lt(o,e){var t=o.getRoot(),s=t.__rememberedObjects.indexOf(e.object);if(s!==-1){var n=t.__rememberedObjectIndecesToControllers[s];if(n===void 0&&(n={},t.__rememberedObjectIndecesToControllers[s]=n),n[e.property]=e,t.load&&t.load.remembered){var i=t.load.remembered,r=void 0;if(i[o.preset])r=i[o.preset];else if(i[de])r=i[de];else return;if(r[s]&&r[s][e.property]!==void 0){var l=r[s][e.property];e.initialValue=l,e.setValue(l)}}}}function ce(o,e,t,s){if(e[t]===void 0)throw new Error('Object "'+e+'" has no property "'+t+'"');var n=void 0;if(s.color)n=new De(e,t);else{var i=[e,t].concat(s.factoryArgs);n=gs.apply(o,i)}s.before instanceof Q&&(s.before=s.before.__li),Lt(o,n),d.addClass(n.domElement,"c");var r=document.createElement("span");d.addClass(r,"property-name"),r.innerHTML=n.property;var l=document.createElement("div");l.appendChild(r),l.appendChild(n.domElement);var a=je(o,l,s.before);return d.addClass(a,M.CLASS_CONTROLLER_ROW),n instanceof De?d.addClass(a,"color"):d.addClass(a,as(n.getValue())),Es(o,a,n),o.__controllers.push(n),n}function ee(o,e){return document.location.href+"."+e}function He(o,e,t){var s=document.createElement("option");s.innerHTML=e,s.value=e,o.__preset_select.appendChild(s),t&&(o.__preset_select.selectedIndex=o.__preset_select.length-1)}function dt(o,e){e.style.display=o.useLocalStorage?"block":"none"}function xs(o){var e=o.__save_row=document.createElement("li");d.addClass(o.domElement,"has-save"),o.__ul.insertBefore(e,o.__ul.firstChild),d.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",d.addClass(t,"button gears");var s=document.createElement("span");s.innerHTML="Save",d.addClass(s,"button"),d.addClass(s,"save");var n=document.createElement("span");n.innerHTML="New",d.addClass(n,"button"),d.addClass(n,"save-as");var i=document.createElement("span");i.innerHTML="Revert",d.addClass(i,"button"),d.addClass(i,"revert");var r=o.__preset_select=document.createElement("select");if(o.load&&o.load.remembered?p.each(o.load.remembered,function(u,h){He(o,h,h===o.preset)}):He(o,de,!1),d.bind(r,"change",function(){for(var u=0;u<o.__preset_select.length;u++)o.__preset_select[u].innerHTML=o.__preset_select[u].value;o.preset=this.value}),e.appendChild(r),e.appendChild(t),e.appendChild(s),e.appendChild(n),e.appendChild(i),ae){var l=document.getElementById("dg-local-explain"),a=document.getElementById("dg-local-storage"),c=document.getElementById("dg-save-locally");c.style.display="block",localStorage.getItem(ee(o,"isLocal"))==="true"&&a.setAttribute("checked","checked"),dt(o,l),d.bind(a,"change",function(){o.useLocalStorage=!o.useLocalStorage,dt(o,l)})}var f=document.getElementById("dg-new-constructor");d.bind(f,"keydown",function(u){u.metaKey&&(u.which===67||u.keyCode===67)&&le.hide()}),d.bind(t,"click",function(){f.innerHTML=JSON.stringify(o.getSaveObject(),void 0,2),le.show(),f.focus(),f.select()}),d.bind(s,"click",function(){o.save()}),d.bind(n,"click",function(){var u=prompt("Enter a new preset name.");u&&o.saveAs(u)}),d.bind(i,"click",function(){o.revert()})}function Ts(o){var e=void 0;o.__resize_handle=document.createElement("div"),p.extend(o.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function t(i){return i.preventDefault(),o.width+=e-i.clientX,o.onResize(),e=i.clientX,!1}function s(){d.removeClass(o.__closeButton,M.CLASS_DRAG),d.unbind(window,"mousemove",t),d.unbind(window,"mouseup",s)}function n(i){return i.preventDefault(),e=i.clientX,d.addClass(o.__closeButton,M.CLASS_DRAG),d.bind(window,"mousemove",t),d.bind(window,"mouseup",s),!1}d.bind(o.__resize_handle,"mousedown",n),d.bind(o.__closeButton,"mousedown",n),o.domElement.insertBefore(o.__resize_handle,o.domElement.firstElementChild)}function Be(o,e){o.domElement.style.width=e+"px",o.__save_row&&o.autoPlace&&(o.__save_row.style.width=e+"px"),o.__closeButton&&(o.__closeButton.style.width=e+"px")}function ge(o,e){var t={};return p.each(o.__rememberedObjects,function(s,n){var i={},r=o.__rememberedObjectIndecesToControllers[n];p.each(r,function(l,a){i[a]=e?l.initialValue:l.getValue()}),t[n]=i}),t}function As(o){for(var e=0;e<o.__preset_select.length;e++)o.__preset_select[e].value===o.preset&&(o.__preset_select.selectedIndex=e)}function Mt(o){o.length!==0&&ys.call(window,function(){Mt(o)}),p.each(o,function(e){e.updateDisplay()})}var Ss=M;const Ms=()=>{const o=We.exports.useRef(null);return We.exports.useEffect(()=>{let e,t,s,n;const i=[],r=new Ss;s=new gn({antialias:!0}),s.setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight),s.setAnimationLoop(y),s.outputEncoding=X,s.toneMapping=bn,s.toneMappingExposure=.85,o.current.appendChild(s.domElement),window.addEventListener("resize",_),e=new vt(40,window.innerWidth/window.innerHeight,.1,100),e.position.set(4.25,1.4,-4.5),n=new Tn(e,o.current),n.enableDamping=!0,n.maxDistance=9,n.target.set(0,.5,0),n.update(),t=new yn,t.background=new D(3355443),t.environment=new is().load("public/models/car/venice_sunset_1k.hdr"),t.environment.mapping=vn,t.fog=new wn(3355443,10,15);const l=new K({color:16711680,metalness:1,roughness:.5,clearcoat:1,clearcoatRoughness:.03,sheen:.5}),a=new xe({color:16777215,metalness:1,roughness:.5}),c=new K({color:16777215,metalness:.25,roughness:0,transmission:1});r.addColor({color:"#ff0000"},"color").name("\u8F66\u8EAB\u989C\u8272").onChange(m=>{l.color.set(m)}),r.addColor({color:"#ffffff"},"color").name("\u5185\u9970\u989C\u8272").onChange(m=>{a.color.set(m)}),r.addColor({color:"#ffffff"},"color").name("\u73BB\u7483\u989C\u8272").onChange(m=>{c.color.set(m)});const f=new mt().load("public/models/car/ferrari_ao.png"),u=new ns;u.setDecoderPath("public/models/car/gltf/");const h=new Sn;h.setDRACOLoader(u),h.load("public/models/car/ferrari.glb",function(m){const g=m.scene.children[0];g.getObjectByName("body").material=l,g.getObjectByName("rim_fl").material=a,g.getObjectByName("rim_fr").material=a,g.getObjectByName("rim_rr").material=a,g.getObjectByName("rim_rl").material=a,g.getObjectByName("trim").material=a,g.getObjectByName("glass").material=c,i.push(g.getObjectByName("wheel_fl"),g.getObjectByName("wheel_fr"),g.getObjectByName("wheel_rl"),g.getObjectByName("wheel_rr"));const v=new bt(new En(.655*4,1.3*4),new te({map:f,blending:xn,toneMapped:!1,transparent:!0}));v.rotation.x=-Math.PI/2,v.renderOrder=2,g.add(v),t.add(g)});function _(){e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)}function y(){n.update();const m=-performance.now()/800;for(let g=0;g<i.length;g++)i[g].rotation.x=m*Math.PI*2;s.render(t,e)}return()=>{r.destroy(),window.removeEventListener("resize",_,!1),o.current.removeChild(s.domElement)}},[]),An("div",{ref:o,style:{width:"100vw",height:"100vh"}})};export{Ms as default};
